# i have two more images, which mimick the office setting, prepared now: 
# TODO: build the newest open-suse leap image

image: dobrautz/neci_base:opensuse42.3

options:
  docker: true

pipelines:
  # default setup: only build for all branches and run unit tests, do not do any testsuite runs!
 default: 
  - step: 
     size: 2x
     script: 
      - rm -rf build 
      - mkdir build 
      - cd build 
      - echo "building release version"
      - cmake ..
      - make -j 
      - echo "done building release version"
      - echo "running unit tests"
      - ctest
      - echo "unit tests passed"

 branches:
   master:
    - step: 
       size: 2x
       script: 
        - rm -rf build 
        - mkdir build 
        - cd build 
        - echo "building release version"
        - cmake ..
        - make -j 
        - echo "done building release version"
        - echo "running unit tests"
        - ctest
        - echo "unit tests passed"
        - echo "running limited test_suite(to save build-minutes)"
        - useradd temp
        - cd ../test_suite
        - su -c "/testcode/bin/testcode.py -c dneci/double_occ/hub_2x2 -c kmneci/Rn_lanczos_fci -c kneci/C_221_int -c mneci/cfqmc/HeHe_5_states -c neci/parallel/C_Solid -vvv" -s /bin/sh temp

