      FUNCTION FACTRL(N)
      IMPLICIT REAL*8 (A-H,O-Z)
      INTEGER N
      REAL*8 FACTRL
      INTEGER J,NTOP
      REAL*8 A(33),GAMMLN
      SAVE NTOP,A
      DATA NTOP,A(1)/0,1.D0/
      IF(N.LT.0)THEN
        PAUSE 'NEGATIVE FACTORIAL IN FACTRL'
      ELSE IF(N.LE.NTOP)THEN
        FACTRL=A(N+1)
      ELSE IF(N.LE.32)THEN
        DO J=NTOP+1,N
	  A(J+1)=J*A(J)
        ENDDO
        NTOP=N
        FACTRL=A(N+1)
      ELSE
        FACTRL=EXP(GAMMLN(N+1.D0))
      ENDIF
      RETURN
      END
C..                                                  
      FUNCTION GAMMLN(XX)
      REAL*8 GAMMLN,XX
      INTEGER J
      DOUBLE PRECISION SER,STP,TMP,X,Y,COF(6)
      SAVE COF,STP
      DATA COF,STP/76.18009172947146D0,-86.50532032941677D0,
     &	   24.01409824083091D0,-1.231739572450155D0,
     &	   0.1208650973866179D-2,-0.5395239384953D-5,
     &	   2.5066282746310005D0/
      X=XX
      Y=X
      TMP=X+5.5D0
      TMP=(X+0.5D0)*LOG(TMP)-TMP
      SER=1.000000000190015D0
      DO J=1,6
        Y=Y+1.D0
        SER=SER+COF(J)/Y
      ENDDO
      GAMMLN=TMP+LOG(STP*SER/X)
      RETURN
      END
