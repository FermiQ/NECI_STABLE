      PROGRAM NECICUBE
      
      USE SYSREAD , only : NEL,TSPN,LMS,TPARITY,IPARITY,NMAXX,NMAXY,
     &  NMAXZ,NMSH,BOX,BOA,COA,TALPHA,ALPHA,ISTATE,TUEG,THUB,UHUB,BHUB,
     &  TTILT,ITILTX,ITILTY,TREADINT,TPBC,TREAL,THFORDER,TCSF,STOT,
     &  FUEGRS,TCPMD,TDFREAD,FRC,TBIN
      USE CALCREAD , only : NEVAL,B2L,NCYCLE,NBLK,NKRY,TRHOOFR,TREAD,
     &  TCORR,TFODM,IOBS,JOBS,KOBS,TENERGY,TMC,NHISTBOXES,BETA,I_P,
     &  TRHOIJ,RHOEPSILON,TREADRHO,NPATHS,TMONTE,IMCSTEPS,IEQSTEPS,
     &  TTROT,I_HMAX,TCALCHMAT,NWHTAY,I_VMAX,TBEGRAPH,TNPDERIV,BETAP,
     &  BETAEQ,TMCDET,MDK,DETINV,TBLOCK,NDETWORK,TSPECDET,SPECDET,
     &  DBETA,ICILEVEL
      USE INTREAD , only : NTAY,THFBASIS,THFCALC,NHFIT,HFMIX,HFEDELTA,
     &  ORBORDER,NFROZEN,NTFROZEN,TRHF,HFCDELTA,IHFMETHOD,TREADHF,
     &  TREADTUMAT
      USE LOGREAD , only : ILOGGING
      use MemoryManager, only: InitMemoryManager,li
      IMPLICIT NONE
      integer ios
      CHARACTER*255 FILENAME
      integer tag
      integer(li) MaxMemBytes

      MaxMemBytes=int(MAXMEM*1024**2,kind=li)
      call InitMemoryManager(MaxMemBytes)

C      INTEGER NHG
C      CALL FAKEREADCHARTABLE(NHG)
C      CALL GENIRREPS
C      CALL GENSYMTABLE
C      STOP
C.. Cleanup from a previous run
C      i=unlink("MCPATHS")
C      OPEN(1,FILE="MCPATHS",STATUS='NEW')
C      CLOSE(1)

      FILENAME=""
      WRITE(6,*) "STARTING NECI"
      ios=0
      CALL READINPUT(FILENAME,ios)

C      CALL READOLDINPUT(NEL,TSPN,LMS,TPARITY,IPARITY,NMAXX,NMAXY,
C     &   NMAXZ,
C     &  NMSH,BOX,BOA,COA,TALPHA,ALPHA,ISTATE,NEVAL,B2L,NCYCLE,NBLK,
C     &  NKRY,TRHOOFR,TREAD,TCORR,TFODM,IOBS,JOBS,KOBS,TENERGY,TMC,
C     &  NHISTBOXES,BETA,I_P,TRHOIJ,RHOEPSILON,TREADRHO,NPATHS,TMONTE,
C     &  IMCSTEPS,IEQSTEPS,TTROT,I_HMAX,TCALCHMAT,NTAY,NWHTAY,I_VMAX,
C     &  ILOGGING,TUEG,TBEGRAPH,THFBASIS,THUB,UHUB,BHUB,ETRIAL,TNPDERIV,
C     & BETAP,BETAEQ,TMCDET,MDK,DETINV,THFCALC,NHFIT,TTILT,ITILTX,ITILTY,
C     & TBLOCK,HFMIX,HFEDELTA,TREADINT,TPBC,TREAL,NDETWORK,ORBORDER,
C     &   NFROZEN,NTFROZEN,TRHF,HFCDELTA,IHFMETHOD,TREADHF,TSPECDET,
C     &  IP_SPECDET,DBETA,TREADTUMAT,THFORDER,TCSF,STOT,ICILEVEL,FUEGRS)

      if (ios.eq.0) 
     & CALL NECICB(NEL,TSPN,LMS,TPARITY,IPARITY,NMAXX,NMAXY,NMAXZ,
     &	NMSH,BOX,BOA,COA,TALPHA,ALPHA,ISTATE,NEVAL,B2L,NCYCLE,NBLK,
     &	NKRY,TRHOOFR,TREAD,TCORR,TFODM,IOBS,JOBS,KOBS,TENERGY,TMC,
     &	NHISTBOXES,BETA,I_P,TRHOIJ,RHOEPSILON,TREADRHO,NPATHS,TMONTE,
     &  IMCSTEPS,IEQSTEPS,TTROT,I_HMAX,TCALCHMAT,NTAY,NWHTAY,I_VMAX,
     &  ILOGGING,TUEG,TBEGRAPH,THFBASIS,THUB,UHUB,BHUB,TNPDERIV,
     & BETAP,BETAEQ,TMCDET,MDK,DETINV,THFCALC,NHFIT,TTILT,ITILTX,ITILTY,
     & TBLOCK,HFMIX,HFEDELTA,TREADINT,TPBC,TREAL,NDETWORK,ORBORDER,
     &   NFROZEN,NTFROZEN,TRHF,HFCDELTA,IHFMETHOD,TREADHF,TSPECDET,
     &   SPECDET,DBETA,TREADTUMAT,THFORDER,TCSF,STOT,ICILEVEL,FUEGRS,
     &   TCPMD,TDFREAD,fRc,0,TBIN)
C..
      
      END
